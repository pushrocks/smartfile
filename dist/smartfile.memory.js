"use strict";
require("typings-global");
var plugins = require("./smartfile.plugins");
var SmartfileInterpreter = require("./smartfile.interpreter");
var Readable = require("stream").Readable;
/**
 * allows you to create a gulp stream
 * from String, from an Array of Strings, from Vinyl File, from an Array of VinylFiles
 * @param fileArg
 * @returns stream.Readable
 * @TODO: make it async;
 */
exports.toGulpStream = function (fileArg, baseArg) {
    if (baseArg === void 0) { baseArg = "/"; }
    var fileArray = [];
    if (typeof fileArg === "string" || fileArg instanceof plugins.vinyl) {
        fileArray.push(fileArg);
    }
    else if (Array.isArray(fileArg)) {
        fileArray = fileArg;
    }
    else {
        throw new Error("fileArg has unknown format");
    }
    var vinylFileArray = []; //we want to have an array of vinylFiles
    for (var fileIndexArg in fileArray) {
        var file = fileArray[fileIndexArg];
        file instanceof plugins.vinyl ?
            vinylFileArray.push(file) :
            vinylFileArray.push(exports.toVinylFileSync(file, { filename: fileIndexArg, base: baseArg }));
    }
    ;
    var stream = new Readable({ objectMode: true });
    for (var vinylFileIndexArg in vinylFileArray) {
        var vinylFile = vinylFileArray[vinylFileIndexArg];
        stream.push(vinylFile);
    }
    ;
    stream.push(null); //signal end of stream;
    return stream;
};
/**
 * converts file to Object
 * @param fileStringArg
 * @param fileTypeArg
 * @returns {any|any}
 */
exports.toObject = function (fileStringArg, fileTypeArg) {
    return SmartfileInterpreter.objectFile(fileStringArg, fileTypeArg);
};
/**
 * takes a string and converts it to vinyl file
 * @param fileArg
 * @param optionsArg
 */
exports.toVinylFileSync = function (fileArg, optionsArg) {
    optionsArg ? void (0) : optionsArg = { filename: "vinylfile", base: "/" };
    optionsArg.filename ? void (0) : optionsArg.filename = "vinylfile";
    optionsArg.base ? void (0) : optionsArg.base = "/";
    optionsArg.relPath ? void ("0") : optionsArg.relPath = "";
    var vinylFile = new plugins.vinyl({
        base: optionsArg.base,
        path: plugins.path.join(optionsArg.base, optionsArg.relPath, optionsArg.filename),
        contents: new Buffer(fileArg)
    });
    return vinylFile;
};
/**
 * takes a string array and some options and returns a vinylfile array
 * @param arrayArg
 * @param optionsArg
 */
exports.toVinylArraySync = function (arrayArg, optionsArg) {
    var vinylArray = [];
    for (var stringIndexArg in arrayArg) {
        var myString = arrayArg[stringIndexArg];
        vinylArray.push(exports.toVinylFileSync(myString, optionsArg));
    }
    return vinylArray;
};
/**
 * takes a vinylFile object and converts it to String
 */
exports.toStringSync = function (fileArg) {
    return fileArg.contents.toString("utf8");
};
/**
 * writes string or vinyl file to disk.
 * @param fileArg
 * @param fileNameArg
 * @param fileBaseArg
 */
exports.toFs = function (fileContentArg, filePathArg) {
    var done = plugins.q.defer();
    //function checks to abort if needed
    if (!fileContentArg || !filePathArg)
        throw new Error("expected valid arguments");
    // prepare actual write action
    var fileString;
    var filePath = filePathArg;
    if (fileContentArg instanceof plugins.vinyl) {
        fileString = exports.toStringSync(fileContentArg);
    }
    else if (typeof fileContentArg === "string") {
        fileString = fileContentArg;
    }
    plugins.fs.writeFile(filePath, fileString, "utf8", done.resolve);
    return done.promise;
};
exports.toFsSync = function (fileArg, filePathArg) {
    //function checks to abort if needed
    if (!fileArg || !filePathArg)
        throw new Error("expected a valid arguments");
    // prepare actual write action
    var fileString;
    var filePath = filePathArg;
    if (fileArg instanceof plugins.vinyl) {
        fileString = exports.toStringSync(fileArg);
    }
    else if (typeof fileArg === "string") {
        fileString = fileArg;
    }
    plugins.fs.writeFileSync(filePath, fileString, "utf8");
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RyxPQUFPLENBQUM7SUFDekIsQ0FBQztJQUNELE9BQU8sQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLFFBQVEsRUFBQyxVQUFVLEVBQUMsTUFBTSxDQUFDLENBQUM7QUFDekQsQ0FBQyxDQUFDIiwiZmlsZSI6InNtYXJ0ZmlsZS5tZW1vcnkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXCJ0eXBpbmdzLWdsb2JhbFwiO1xuXG5pbXBvcnQgcGx1Z2lucyA9IHJlcXVpcmUoXCIuL3NtYXJ0ZmlsZS5wbHVnaW5zXCIpO1xuaW1wb3J0IFNtYXJ0ZmlsZUludGVycHJldGVyID0gcmVxdWlyZShcIi4vc21hcnRmaWxlLmludGVycHJldGVyXCIpO1xuaW1wb3J0IHZpbnlsID0gcmVxdWlyZShcInZpbnlsXCIpO1xubGV0IFJlYWRhYmxlID0gcmVxdWlyZShcInN0cmVhbVwiKS5SZWFkYWJsZTtcbi8qKlxuICogYWxsb3dzIHlvdSB0byBjcmVhdGUgYSBndWxwIHN0cmVhbVxuICogZnJvbSBTdHJpbmcsIGZyb20gYW4gQXJyYXkgb2YgU3RyaW5ncywgZnJvbSBWaW55bCBGaWxlLCBmcm9tIGFuIEFycmF5IG9mIFZpbnlsRmlsZXNcbiAqIEBwYXJhbSBmaWxlQXJnXG4gKiBAcmV0dXJucyBzdHJlYW0uUmVhZGFibGVcbiAqIEBUT0RPOiBtYWtlIGl0IGFzeW5jO1xuICovXG5leHBvcnQgbGV0IHRvR3VscFN0cmVhbSA9IGZ1bmN0aW9uKGZpbGVBcmc6c3RyaW5nfHN0cmluZ1tdfHBsdWdpbnMudmlueWx8cGx1Z2lucy52aW55bFtdLGJhc2VBcmc6c3RyaW5nID0gXCIvXCIpe1xuICAgIGxldCBmaWxlQXJyYXkgPSBbXTtcblxuICAgIGlmKHR5cGVvZiBmaWxlQXJnID09PSBcInN0cmluZ1wiIHx8IGZpbGVBcmcgaW5zdGFuY2VvZiBwbHVnaW5zLnZpbnlsKXsgLy8gbWFrZSBzdXJlIHdlIHdvcmsgd2l0aCBhbiBhcnJheSBsYXRlciBvblxuICAgICAgICBmaWxlQXJyYXkucHVzaChmaWxlQXJnKTtcbiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkoZmlsZUFyZykpe1xuICAgICAgICBmaWxlQXJyYXkgPSBmaWxlQXJnO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImZpbGVBcmcgaGFzIHVua25vd24gZm9ybWF0XCIpO1xuICAgIH1cblxuICAgIGxldCB2aW55bEZpbGVBcnJheTpwbHVnaW5zLnZpbnlsW10gPSBbXTsgLy93ZSB3YW50IHRvIGhhdmUgYW4gYXJyYXkgb2YgdmlueWxGaWxlc1xuXG4gICAgZm9yIChsZXQgZmlsZUluZGV4QXJnIGluIGZpbGVBcnJheSl7IC8vY29udmVydCBmaWxlQXJyYXkgaW4gdmlueWxBcnJheVxuICAgICAgICBsZXQgZmlsZSA9IGZpbGVBcnJheVtmaWxlSW5kZXhBcmddO1xuICAgICAgICBmaWxlIGluc3RhbmNlb2YgcGx1Z2lucy52aW55bCA/XG4gICAgICAgICAgICB2aW55bEZpbGVBcnJheS5wdXNoKGZpbGUpIDpcbiAgICAgICAgICAgIHZpbnlsRmlsZUFycmF5LnB1c2godG9WaW55bEZpbGVTeW5jKGZpbGUse2ZpbGVuYW1lOmZpbGVJbmRleEFyZyxiYXNlOmJhc2VBcmd9KSk7XG4gICAgfTtcblxuICAgIGxldCBzdHJlYW0gPSBuZXcgUmVhZGFibGUoeyBvYmplY3RNb2RlOiB0cnVlIH0pO1xuICAgIGZvcihsZXQgdmlueWxGaWxlSW5kZXhBcmcgaW4gdmlueWxGaWxlQXJyYXkpe1xuICAgICAgICBsZXQgdmlueWxGaWxlID0gdmlueWxGaWxlQXJyYXlbdmlueWxGaWxlSW5kZXhBcmddO1xuICAgICAgICBzdHJlYW0ucHVzaCh2aW55bEZpbGUpO1xuICAgIH07XG4gICAgc3RyZWFtLnB1c2gobnVsbCk7IC8vc2lnbmFsIGVuZCBvZiBzdHJlYW07XG4gICAgcmV0dXJuIHN0cmVhbTtcbn07XG5cbi8qKlxuICogY29udmVydHMgZmlsZSB0byBPYmplY3RcbiAqIEBwYXJhbSBmaWxlU3RyaW5nQXJnXG4gKiBAcGFyYW0gZmlsZVR5cGVBcmdcbiAqIEByZXR1cm5zIHthbnl8YW55fVxuICovXG5leHBvcnQgbGV0IHRvT2JqZWN0ID0gZnVuY3Rpb24oZmlsZVN0cmluZ0FyZzpzdHJpbmcsZmlsZVR5cGVBcmc6c3RyaW5nKXtcbiAgICByZXR1cm4gU21hcnRmaWxlSW50ZXJwcmV0ZXIub2JqZWN0RmlsZShmaWxlU3RyaW5nQXJnLGZpbGVUeXBlQXJnKTtcbn07XG5cbi8qKlxuICogdGFrZXMgYSBzdHJpbmcgYW5kIGNvbnZlcnRzIGl0IHRvIHZpbnlsIGZpbGVcbiAqIEBwYXJhbSBmaWxlQXJnXG4gKiBAcGFyYW0gb3B0aW9uc0FyZ1xuICovXG5leHBvcnQgbGV0IHRvVmlueWxGaWxlU3luYyA9IGZ1bmN0aW9uKGZpbGVBcmc6c3RyaW5nLG9wdGlvbnNBcmc/OntmaWxlbmFtZT86c3RyaW5nLGJhc2U/OnN0cmluZyxyZWxQYXRoPzpzdHJpbmd9KXtcbiAgICBvcHRpb25zQXJnPyB2b2lkKDApIDogb3B0aW9uc0FyZyA9IHtmaWxlbmFtZTogXCJ2aW55bGZpbGVcIiwgYmFzZTogXCIvXCJ9O1xuICAgIG9wdGlvbnNBcmcuZmlsZW5hbWUgPyB2b2lkKDApIDogb3B0aW9uc0FyZy5maWxlbmFtZSA9IFwidmlueWxmaWxlXCI7XG4gICAgb3B0aW9uc0FyZy5iYXNlID8gdm9pZCgwKSA6IG9wdGlvbnNBcmcuYmFzZSA9IFwiL1wiO1xuICAgIG9wdGlvbnNBcmcucmVsUGF0aCA/IHZvaWQoXCIwXCIpIDogb3B0aW9uc0FyZy5yZWxQYXRoID0gXCJcIjtcbiAgICBsZXQgdmlueWxGaWxlID0gbmV3IHBsdWdpbnMudmlueWwoe1xuICAgICAgICBiYXNlOiBvcHRpb25zQXJnLmJhc2UsXG4gICAgICAgIHBhdGg6IHBsdWdpbnMucGF0aC5qb2luKG9wdGlvbnNBcmcuYmFzZSxvcHRpb25zQXJnLnJlbFBhdGgsb3B0aW9uc0FyZy5maWxlbmFtZSksXG4gICAgICAgIGNvbnRlbnRzOiBuZXcgQnVmZmVyKGZpbGVBcmcpXG4gICAgfSk7XG4gICAgcmV0dXJuIHZpbnlsRmlsZTtcbn07XG5cbi8qKlxuICogdGFrZXMgYSBzdHJpbmcgYXJyYXkgYW5kIHNvbWUgb3B0aW9ucyBhbmQgcmV0dXJucyBhIHZpbnlsZmlsZSBhcnJheVxuICogQHBhcmFtIGFycmF5QXJnXG4gKiBAcGFyYW0gb3B0aW9uc0FyZ1xuICovXG5leHBvcnQgbGV0IHRvVmlueWxBcnJheVN5bmMgPSBmdW5jdGlvbihhcnJheUFyZzpzdHJpbmdbXSxvcHRpb25zQXJnPzp7ZmlsZW5hbWU/OnN0cmluZyxiYXNlPzpzdHJpbmcscmVsUGF0aD86c3RyaW5nfSl7XG4gICAgbGV0IHZpbnlsQXJyYXkgPSBbXTtcbiAgICBmb3IobGV0IHN0cmluZ0luZGV4QXJnIGluIGFycmF5QXJnKXtcbiAgICAgICAgbGV0IG15U3RyaW5nID0gYXJyYXlBcmdbc3RyaW5nSW5kZXhBcmddO1xuICAgICAgICB2aW55bEFycmF5LnB1c2godG9WaW55bEZpbGVTeW5jKG15U3RyaW5nLG9wdGlvbnNBcmcpKTtcbiAgICB9XG4gICAgcmV0dXJuIHZpbnlsQXJyYXk7XG59O1xuXG5cbi8qKlxuICogdGFrZXMgYSB2aW55bEZpbGUgb2JqZWN0IGFuZCBjb252ZXJ0cyBpdCB0byBTdHJpbmdcbiAqL1xuZXhwb3J0IGxldCB0b1N0cmluZ1N5bmMgPSBmdW5jdGlvbihmaWxlQXJnOnBsdWdpbnMudmlueWwpe1xuICAgIHJldHVybiBmaWxlQXJnLmNvbnRlbnRzLnRvU3RyaW5nKFwidXRmOFwiKTtcbn07XG5cblxuLyoqXG4gKiB3cml0ZXMgc3RyaW5nIG9yIHZpbnlsIGZpbGUgdG8gZGlzay5cbiAqIEBwYXJhbSBmaWxlQXJnXG4gKiBAcGFyYW0gZmlsZU5hbWVBcmdcbiAqIEBwYXJhbSBmaWxlQmFzZUFyZ1xuICovXG5leHBvcnQgbGV0IHRvRnMgPSBmdW5jdGlvbihmaWxlQ29udGVudEFyZzpzdHJpbmd8dmlueWwsZmlsZVBhdGhBcmcpe1xuICAgIGxldCBkb25lID0gcGx1Z2lucy5xLmRlZmVyKCk7XG5cbiAgICAvL2Z1bmN0aW9uIGNoZWNrcyB0byBhYm9ydCBpZiBuZWVkZWRcbiAgICBpZiAoIWZpbGVDb250ZW50QXJnIHx8ICFmaWxlUGF0aEFyZykgdGhyb3cgbmV3IEVycm9yKFwiZXhwZWN0ZWQgdmFsaWQgYXJndW1lbnRzXCIpO1xuXG4gICAgLy8gcHJlcGFyZSBhY3R1YWwgd3JpdGUgYWN0aW9uXG4gICAgbGV0IGZpbGVTdHJpbmc6c3RyaW5nO1xuICAgIGxldCBmaWxlUGF0aDpzdHJpbmcgPSBmaWxlUGF0aEFyZztcbiAgICBpZiAoZmlsZUNvbnRlbnRBcmcgaW5zdGFuY2VvZiBwbHVnaW5zLnZpbnlsKXtcbiAgICAgICAgZmlsZVN0cmluZyA9IHRvU3RyaW5nU3luYyhmaWxlQ29udGVudEFyZyk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgZmlsZUNvbnRlbnRBcmcgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgZmlsZVN0cmluZyA9IGZpbGVDb250ZW50QXJnO1xuICAgIH1cbiAgICBwbHVnaW5zLmZzLndyaXRlRmlsZShmaWxlUGF0aCxmaWxlU3RyaW5nLFwidXRmOFwiLGRvbmUucmVzb2x2ZSk7XG4gICAgcmV0dXJuIGRvbmUucHJvbWlzZTtcbn07XG5cbmV4cG9ydCBsZXQgdG9Gc1N5bmMgPSBmdW5jdGlvbihmaWxlQXJnLGZpbGVQYXRoQXJnOnN0cmluZyl7XG4gICAgLy9mdW5jdGlvbiBjaGVja3MgdG8gYWJvcnQgaWYgbmVlZGVkXG4gICAgaWYgKCFmaWxlQXJnIHx8ICFmaWxlUGF0aEFyZykgdGhyb3cgbmV3IEVycm9yKFwiZXhwZWN0ZWQgYSB2YWxpZCBhcmd1bWVudHNcIik7XG5cbiAgICAvLyBwcmVwYXJlIGFjdHVhbCB3cml0ZSBhY3Rpb25cbiAgICBsZXQgZmlsZVN0cmluZzpzdHJpbmc7XG4gICAgbGV0IGZpbGVQYXRoOnN0cmluZyA9IGZpbGVQYXRoQXJnO1xuXG4gICAgaWYgKGZpbGVBcmcgaW5zdGFuY2VvZiBwbHVnaW5zLnZpbnlsKXtcbiAgICAgICAgZmlsZVN0cmluZyA9IHRvU3RyaW5nU3luYyhmaWxlQXJnKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBmaWxlQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGZpbGVTdHJpbmcgPSBmaWxlQXJnO1xuICAgIH1cbiAgICBwbHVnaW5zLmZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsZmlsZVN0cmluZyxcInV0ZjhcIik7XG59O1xuXG4iXX0=
