"use strict";
require("typings-global");
var plugins = require("./smartfile.plugins");
var SmartfileInterpreter = require("./smartfile.interpreter");
var Readable = require("stream").Readable;
/**
 * allows you to create a gulp stream
 * from String, from an Array of Strings, from Vinyl File, from an Array of VinylFiles
 * @param fileArg
 * @returns stream.Readable
 * @TODO: make it async;
 */
exports.toGulpStream = function (fileArg, baseArg) {
    if (baseArg === void 0) { baseArg = "/"; }
    var fileArray = [];
    if (typeof fileArg === "string" || fileArg instanceof plugins.vinyl) {
        fileArray.push(fileArg);
    }
    else if (Array.isArray(fileArg)) {
        fileArray = fileArg;
    }
    else {
        throw new Error("fileArg has unknown format");
    }
    var vinylFileArray = []; //we want to have an array of vinylFiles
    for (var fileIndexArg in fileArray) {
        var file = fileArray[fileIndexArg];
        file instanceof plugins.vinyl ?
            vinylFileArray.push(file) :
            vinylFileArray.push(exports.toVinylFileSync(file, { filename: fileIndexArg, base: baseArg }));
    }
    ;
    var stream = new Readable({ objectMode: true });
    for (var vinylFileIndexArg in vinylFileArray) {
        var vinylFile = vinylFileArray[vinylFileIndexArg];
        stream.push(vinylFile);
    }
    ;
    stream.push(null); //signal end of stream;
    return stream;
};
/**
 * converts file to Object
 * @param fileStringArg
 * @param fileTypeArg
 * @returns {any|any}
 */
exports.toObject = function (fileStringArg, fileTypeArg) {
    return SmartfileInterpreter.objectFile(fileStringArg, fileTypeArg);
};
/**
 * takes a string and converts it to vinyl file
 * @param fileArg
 * @param optionsArg
 */
exports.toVinylFileSync = function (fileArg, optionsArg) {
    optionsArg ? void (0) : optionsArg = { filename: "vinylfile", base: "/" };
    optionsArg.filename ? void (0) : optionsArg.filename = "vinylfile";
    optionsArg.base ? void (0) : optionsArg.base = "/";
    optionsArg.relPath ? void ("0") : optionsArg.relPath = "";
    var vinylFile = new plugins.vinyl({
        base: optionsArg.base,
        path: plugins.path.join(optionsArg.base, optionsArg.relPath, optionsArg.filename),
        contents: new Buffer(fileArg)
    });
    return vinylFile;
};
/**
 * takes a string array and some options and returns a vinylfile array
 * @param arrayArg
 * @param optionsArg
 */
exports.toVinylArraySync = function (arrayArg, optionsArg) {
    var vinylArray = [];
    for (var stringIndexArg in arrayArg) {
        var myString = arrayArg[stringIndexArg];
        vinylArray.push(exports.toVinylFileSync(myString, optionsArg));
    }
    return vinylArray;
};
/**
 * takes a vinylFile object and converts it to String
 */
exports.toStringSync = function (fileArg) {
    return fileArg.contents.toString("utf8");
};
/**
 * writes string or vinyl file to disk.
 * @param fileArg
 * @param fileNameArg
 * @param fileBaseArg
 */
exports.toFs = function (fileArg, optionsArg) {
    var done = plugins.q.defer();
    //function checks to abort if needed
    if (!fileArg || !optionsArg || !(typeof optionsArg.fileName === "string"))
        throw new Error("expected a valid arguments");
    if (!(typeof optionsArg.filePath === "string"))
        optionsArg.filePath = "/";
    var filePath = plugins.path.join(optionsArg.filePath, optionsArg.fileName);
    var fileString;
    if (fileArg instanceof plugins.vinyl) {
        fileString = exports.toStringSync(fileArg);
    }
    else if (typeof fileArg === "string") {
        fileString = fileArg;
    }
    plugins.fs.writeFile(filePath, fileString, "utf8", done.resolve);
    return done.promise;
};
exports.toFsSync = function (fileArg, optionsArg) {
    //function checks to abort if needed
    if (!fileArg || !optionsArg || !(typeof optionsArg.fileName === "string"))
        throw new Error("expected a valid arguments");
    if (!(typeof optionsArg.filePath === "string"))
        optionsArg.filePath = "/";
    var filePath = plugins.path.join(optionsArg.filePath, optionsArg.fileName);
    var fileString;
    if (fileArg instanceof plugins.vinyl) {
        fileString = exports.toStringSync(fileArg);
    }
    else if (typeof fileArg === "string") {
        fileString = fileArg;
    }
    plugins.fs.writeFileSync(filePath, fileString, "utf8");
};

//# sourceMappingURL=data:application/json;charset=utf8;base64,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O0lBQ2xELEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLFVBQVUsQ0FBQyxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUM7UUFBQyxVQUFVLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQztJQUUxRSxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMxRSxJQUFJLFVBQWlCLENBQUM7SUFFdEIsRUFBRSxDQUFDLENBQUMsT0FBTyxZQUFZLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQSxDQUFDO1FBQ2xDLFVBQVUsR0FBRyxvQkFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxPQUFPLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNyQyxVQUFVLEdBQUcsT0FBTyxDQUFDO0lBQ3pCLENBQUM7SUFDRCxPQUFPLENBQUMsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUMsVUFBVSxFQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3pELENBQUMsQ0FBQyIsImZpbGUiOiJzbWFydGZpbGUubWVtb3J5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFwidHlwaW5ncy1nbG9iYWxcIjtcblxuaW1wb3J0IHBsdWdpbnMgPSByZXF1aXJlKFwiLi9zbWFydGZpbGUucGx1Z2luc1wiKTtcbmltcG9ydCBTbWFydGZpbGVJbnRlcnByZXRlciA9IHJlcXVpcmUoXCIuL3NtYXJ0ZmlsZS5pbnRlcnByZXRlclwiKTtcbmxldCBSZWFkYWJsZSA9IHJlcXVpcmUoXCJzdHJlYW1cIikuUmVhZGFibGU7XG4vKipcbiAqIGFsbG93cyB5b3UgdG8gY3JlYXRlIGEgZ3VscCBzdHJlYW1cbiAqIGZyb20gU3RyaW5nLCBmcm9tIGFuIEFycmF5IG9mIFN0cmluZ3MsIGZyb20gVmlueWwgRmlsZSwgZnJvbSBhbiBBcnJheSBvZiBWaW55bEZpbGVzXG4gKiBAcGFyYW0gZmlsZUFyZ1xuICogQHJldHVybnMgc3RyZWFtLlJlYWRhYmxlXG4gKiBAVE9ETzogbWFrZSBpdCBhc3luYztcbiAqL1xuZXhwb3J0IGxldCB0b0d1bHBTdHJlYW0gPSBmdW5jdGlvbihmaWxlQXJnOnN0cmluZ3xzdHJpbmdbXXxwbHVnaW5zLnZpbnlsfHBsdWdpbnMudmlueWxbXSxiYXNlQXJnOnN0cmluZyA9IFwiL1wiKXtcbiAgICBsZXQgZmlsZUFycmF5ID0gW107XG5cbiAgICBpZih0eXBlb2YgZmlsZUFyZyA9PT0gXCJzdHJpbmdcIiB8fCBmaWxlQXJnIGluc3RhbmNlb2YgcGx1Z2lucy52aW55bCl7IC8vIG1ha2Ugc3VyZSB3ZSB3b3JrIHdpdGggYW4gYXJyYXkgbGF0ZXIgb25cbiAgICAgICAgZmlsZUFycmF5LnB1c2goZmlsZUFyZyk7XG4gICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGZpbGVBcmcpKXtcbiAgICAgICAgZmlsZUFycmF5ID0gZmlsZUFyZztcbiAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJmaWxlQXJnIGhhcyB1bmtub3duIGZvcm1hdFwiKTtcbiAgICB9XG5cbiAgICBsZXQgdmlueWxGaWxlQXJyYXk6cGx1Z2lucy52aW55bFtdID0gW107IC8vd2Ugd2FudCB0byBoYXZlIGFuIGFycmF5IG9mIHZpbnlsRmlsZXNcblxuICAgIGZvciAobGV0IGZpbGVJbmRleEFyZyBpbiBmaWxlQXJyYXkpeyAvL2NvbnZlcnQgZmlsZUFycmF5IGluIHZpbnlsQXJyYXlcbiAgICAgICAgbGV0IGZpbGUgPSBmaWxlQXJyYXlbZmlsZUluZGV4QXJnXTtcbiAgICAgICAgZmlsZSBpbnN0YW5jZW9mIHBsdWdpbnMudmlueWwgP1xuICAgICAgICAgICAgdmlueWxGaWxlQXJyYXkucHVzaChmaWxlKSA6XG4gICAgICAgICAgICB2aW55bEZpbGVBcnJheS5wdXNoKHRvVmlueWxGaWxlU3luYyhmaWxlLHtmaWxlbmFtZTpmaWxlSW5kZXhBcmcsYmFzZTpiYXNlQXJnfSkpO1xuICAgIH07XG5cbiAgICBsZXQgc3RyZWFtID0gbmV3IFJlYWRhYmxlKHsgb2JqZWN0TW9kZTogdHJ1ZSB9KTtcbiAgICBmb3IobGV0IHZpbnlsRmlsZUluZGV4QXJnIGluIHZpbnlsRmlsZUFycmF5KXtcbiAgICAgICAgbGV0IHZpbnlsRmlsZSA9IHZpbnlsRmlsZUFycmF5W3ZpbnlsRmlsZUluZGV4QXJnXTtcbiAgICAgICAgc3RyZWFtLnB1c2godmlueWxGaWxlKTtcbiAgICB9O1xuICAgIHN0cmVhbS5wdXNoKG51bGwpOyAvL3NpZ25hbCBlbmQgb2Ygc3RyZWFtO1xuICAgIHJldHVybiBzdHJlYW07XG59O1xuXG4vKipcbiAqIGNvbnZlcnRzIGZpbGUgdG8gT2JqZWN0XG4gKiBAcGFyYW0gZmlsZVN0cmluZ0FyZ1xuICogQHBhcmFtIGZpbGVUeXBlQXJnXG4gKiBAcmV0dXJucyB7YW55fGFueX1cbiAqL1xuZXhwb3J0IGxldCB0b09iamVjdCA9IGZ1bmN0aW9uKGZpbGVTdHJpbmdBcmc6c3RyaW5nLGZpbGVUeXBlQXJnOnN0cmluZyl7XG4gICAgcmV0dXJuIFNtYXJ0ZmlsZUludGVycHJldGVyLm9iamVjdEZpbGUoZmlsZVN0cmluZ0FyZyxmaWxlVHlwZUFyZyk7XG59O1xuXG4vKipcbiAqIHRha2VzIGEgc3RyaW5nIGFuZCBjb252ZXJ0cyBpdCB0byB2aW55bCBmaWxlXG4gKiBAcGFyYW0gZmlsZUFyZ1xuICogQHBhcmFtIG9wdGlvbnNBcmdcbiAqL1xuZXhwb3J0IGxldCB0b1ZpbnlsRmlsZVN5bmMgPSBmdW5jdGlvbihmaWxlQXJnOnN0cmluZyxvcHRpb25zQXJnPzp7ZmlsZW5hbWU/OnN0cmluZyxiYXNlPzpzdHJpbmcscmVsUGF0aD86c3RyaW5nfSl7XG4gICAgb3B0aW9uc0FyZz8gdm9pZCgwKSA6IG9wdGlvbnNBcmcgPSB7ZmlsZW5hbWU6IFwidmlueWxmaWxlXCIsIGJhc2U6IFwiL1wifTtcbiAgICBvcHRpb25zQXJnLmZpbGVuYW1lID8gdm9pZCgwKSA6IG9wdGlvbnNBcmcuZmlsZW5hbWUgPSBcInZpbnlsZmlsZVwiO1xuICAgIG9wdGlvbnNBcmcuYmFzZSA/IHZvaWQoMCkgOiBvcHRpb25zQXJnLmJhc2UgPSBcIi9cIjtcbiAgICBvcHRpb25zQXJnLnJlbFBhdGggPyB2b2lkKFwiMFwiKSA6IG9wdGlvbnNBcmcucmVsUGF0aCA9IFwiXCI7XG4gICAgbGV0IHZpbnlsRmlsZSA9IG5ldyBwbHVnaW5zLnZpbnlsKHtcbiAgICAgICAgYmFzZTogb3B0aW9uc0FyZy5iYXNlLFxuICAgICAgICBwYXRoOiBwbHVnaW5zLnBhdGguam9pbihvcHRpb25zQXJnLmJhc2Usb3B0aW9uc0FyZy5yZWxQYXRoLG9wdGlvbnNBcmcuZmlsZW5hbWUpLFxuICAgICAgICBjb250ZW50czogbmV3IEJ1ZmZlcihmaWxlQXJnKVxuICAgIH0pO1xuICAgIHJldHVybiB2aW55bEZpbGU7XG59O1xuXG4vKipcbiAqIHRha2VzIGEgc3RyaW5nIGFycmF5IGFuZCBzb21lIG9wdGlvbnMgYW5kIHJldHVybnMgYSB2aW55bGZpbGUgYXJyYXlcbiAqIEBwYXJhbSBhcnJheUFyZ1xuICogQHBhcmFtIG9wdGlvbnNBcmdcbiAqL1xuZXhwb3J0IGxldCB0b1ZpbnlsQXJyYXlTeW5jID0gZnVuY3Rpb24oYXJyYXlBcmc6c3RyaW5nW10sb3B0aW9uc0FyZz86e2ZpbGVuYW1lPzpzdHJpbmcsYmFzZT86c3RyaW5nLHJlbFBhdGg/OnN0cmluZ30pe1xuICAgIGxldCB2aW55bEFycmF5ID0gW107XG4gICAgZm9yKGxldCBzdHJpbmdJbmRleEFyZyBpbiBhcnJheUFyZyl7XG4gICAgICAgIGxldCBteVN0cmluZyA9IGFycmF5QXJnW3N0cmluZ0luZGV4QXJnXTtcbiAgICAgICAgdmlueWxBcnJheS5wdXNoKHRvVmlueWxGaWxlU3luYyhteVN0cmluZyxvcHRpb25zQXJnKSk7XG4gICAgfVxuICAgIHJldHVybiB2aW55bEFycmF5O1xufTtcblxuXG4vKipcbiAqIHRha2VzIGEgdmlueWxGaWxlIG9iamVjdCBhbmQgY29udmVydHMgaXQgdG8gU3RyaW5nXG4gKi9cbmV4cG9ydCBsZXQgdG9TdHJpbmdTeW5jID0gZnVuY3Rpb24oZmlsZUFyZzpwbHVnaW5zLnZpbnlsKXtcbiAgICByZXR1cm4gZmlsZUFyZy5jb250ZW50cy50b1N0cmluZyhcInV0ZjhcIik7XG59O1xuXG5cbi8qKlxuICogd3JpdGVzIHN0cmluZyBvciB2aW55bCBmaWxlIHRvIGRpc2suXG4gKiBAcGFyYW0gZmlsZUFyZ1xuICogQHBhcmFtIGZpbGVOYW1lQXJnXG4gKiBAcGFyYW0gZmlsZUJhc2VBcmdcbiAqL1xuZXhwb3J0IGxldCB0b0ZzID0gZnVuY3Rpb24oZmlsZUFyZyxvcHRpb25zQXJnOntmaWxlTmFtZTpzdHJpbmcsZmlsZVBhdGg6c3RyaW5nfSl7XG4gICAgbGV0IGRvbmUgPSBwbHVnaW5zLnEuZGVmZXIoKTtcblxuICAgIC8vZnVuY3Rpb24gY2hlY2tzIHRvIGFib3J0IGlmIG5lZWRlZFxuICAgIGlmICghZmlsZUFyZyB8fCAhb3B0aW9uc0FyZyB8fCAhKHR5cGVvZiBvcHRpb25zQXJnLmZpbGVOYW1lID09PSBcInN0cmluZ1wiKSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZXhwZWN0ZWQgYSB2YWxpZCBhcmd1bWVudHNcIik7XG4gICAgaWYgKCEodHlwZW9mIG9wdGlvbnNBcmcuZmlsZVBhdGggPT09IFwic3RyaW5nXCIpKSBvcHRpb25zQXJnLmZpbGVQYXRoID0gXCIvXCI7XG5cbiAgICBsZXQgZmlsZVBhdGg6c3RyaW5nID0gcGx1Z2lucy5wYXRoLmpvaW4ob3B0aW9uc0FyZy5maWxlUGF0aCxvcHRpb25zQXJnLmZpbGVOYW1lKTtcbiAgICBsZXQgZmlsZVN0cmluZzpzdHJpbmc7XG4gICAgaWYgKGZpbGVBcmcgaW5zdGFuY2VvZiBwbHVnaW5zLnZpbnlsKXtcbiAgICAgICAgZmlsZVN0cmluZyA9IHRvU3RyaW5nU3luYyhmaWxlQXJnKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBmaWxlQXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGZpbGVTdHJpbmcgPSBmaWxlQXJnO1xuICAgIH1cbiAgICBwbHVnaW5zLmZzLndyaXRlRmlsZShmaWxlUGF0aCxmaWxlU3RyaW5nLFwidXRmOFwiLGRvbmUucmVzb2x2ZSk7XG4gICAgcmV0dXJuIGRvbmUucHJvbWlzZTtcbn07XG5cbmV4cG9ydCBsZXQgdG9Gc1N5bmMgPSBmdW5jdGlvbihmaWxlQXJnLG9wdGlvbnNBcmc6e2ZpbGVOYW1lOnN0cmluZyxmaWxlUGF0aDpzdHJpbmd9KXtcbiAgICAvL2Z1bmN0aW9uIGNoZWNrcyB0byBhYm9ydCBpZiBuZWVkZWRcbiAgICBpZiAoIWZpbGVBcmcgfHwgIW9wdGlvbnNBcmcgfHwgISh0eXBlb2Ygb3B0aW9uc0FyZy5maWxlTmFtZSA9PT0gXCJzdHJpbmdcIikpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcImV4cGVjdGVkIGEgdmFsaWQgYXJndW1lbnRzXCIpO1xuICAgIGlmICghKHR5cGVvZiBvcHRpb25zQXJnLmZpbGVQYXRoID09PSBcInN0cmluZ1wiKSkgb3B0aW9uc0FyZy5maWxlUGF0aCA9IFwiL1wiO1xuXG4gICAgbGV0IGZpbGVQYXRoID0gcGx1Z2lucy5wYXRoLmpvaW4ob3B0aW9uc0FyZy5maWxlUGF0aCxvcHRpb25zQXJnLmZpbGVOYW1lKTtcbiAgICBsZXQgZmlsZVN0cmluZzpzdHJpbmc7XG5cbiAgICBpZiAoZmlsZUFyZyBpbnN0YW5jZW9mIHBsdWdpbnMudmlueWwpe1xuICAgICAgICBmaWxlU3RyaW5nID0gdG9TdHJpbmdTeW5jKGZpbGVBcmcpO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGZpbGVBcmcgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgZmlsZVN0cmluZyA9IGZpbGVBcmc7XG4gICAgfVxuICAgIHBsdWdpbnMuZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCxmaWxlU3RyaW5nLFwidXRmOFwiKTtcbn07XG5cbiJdfQ==
